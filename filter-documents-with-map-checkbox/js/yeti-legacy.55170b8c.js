(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["yeti"],{"01d46":function(t,e,a){"use strict";a("a2cc")},"03a8":function(t,e,a){},"0c6e":function(t,e,a){t.exports=a.p+"img/logo-ensg.12db1227.avif"},"12da":function(t,e,a){},1502:function(t,e,a){},"2d99":function(t,e,a){"use strict";a("5a2e")},"2eb6":function(t,e,a){"use strict";a("f894")},"3d7f":function(t,e,a){t.exports=a.p+"img/logo-fondation-petzl.1d7d0bdd.avif"},4508:function(t,e,a){"use strict";a("88ef")},"57ee":function(t,e,a){"use strict";a("ac4e")},"5a2e":function(t,e,a){},"60a4":function(t,e,a){t.exports=a.p+"img/levels-danger.ab1771e4.svg"},"806a":function(t,e,a){"use strict";a("1502")},8309:function(t,e,a){"use strict";a("12da")},"873e":function(t,e,a){"use strict";a("e237")},"88ef":function(t,e,a){},9209:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"section"},[a("html-header",{attrs:{title:"Yeti"}}),t._v(" "),a("div",{staticClass:"box"},[a("h1",{staticClass:"title is-1"},[a("div",{staticClass:"yeti-icon is-inline-block"},[a("icon-yeti")],1),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("YETI - A preparation tool for your outing")])])]),t._v(" "),a("div",{staticClass:"yeti-app"},[t.showDisclaimer?a("div",{staticClass:"box yeti-overlay"},[a("yeti-article",{staticClass:"yeti-article--disclaimer",attrs:{article:t.articles.disclaimer}}),t._v(" "),a("form",{attrs:{action:"#"},on:{submit:t.onSubmitDisclaimer}},[a("input-checkbox",{directives:[{name:"translate",rawName:"v-translate"}],model:{value:t.checkDisclaimer,callback:function(e){t.checkDisclaimer=e},expression:"checkDisclaimer"}},[t._v("\n          I read and understood the interest and limitations of YETI\n        ")]),t._v(" "),a("button",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"button is-primary",attrs:{disabled:!t.checkDisclaimer}},[t._v("Launch YETI")])],1)],1):t._e(),t._v(" "),"faq"===t.$route.params.page?a("div",{staticClass:"box yeti-overlay"},[a("p",[a("router-link",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{to:"."}},[t._v("Go back to YETI")])],1),t._v(" "),a("yeti-article",{staticClass:"yeti-article--disclaimer",attrs:{article:t.articles.disclaimer}}),t._v(" "),a("yeti-article",{attrs:{article:t.articles.faq}})],1):t._e(),t._v(" "),a("div",{staticClass:"columns yeti-content"},[a("div",{staticClass:"column is-6-tablet is-6-desktop is-5-widescreen is-4-fullhd form-container"},[a("div",{staticClass:"columns mb-0 yeti-columns--reverse is-mobile"},[a("ul",{staticClass:"column is-narrow pb-0"},[a("li",[a("router-link",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"is-block yetitabs-link",attrs:{to:t.$route.fullPath+"/faq"}},[t._v("\n                FAQ?\n              ")])],1)]),t._v(" "),a("tabs",{attrs:{tabs:t.tabs,"active-tab":t.activeTab,"has-features":t.hasFeatures},on:{"update:activeTab":function(e){t.activeTab=e},"update:active-tab":function(e){t.activeTab=e}}})],1),t._v(" "),a("div",{staticClass:"box"},[a("panel",{ref:"panel0",staticClass:"is-relative",attrs:{index:0,"active-tab":t.activeTab}},[a("validation-button",{staticClass:"is-hidden-mobile yeti-validation--top",attrs:{"current-error":t.currentError,loading:t.promise,tabindex:"-1"},on:{click:t.compute}}),t._v(" "),a("sub-panel-bra",{attrs:{bra:t.bra,mountains:t.mountains},on:{"update:bra":function(e){t.bra=e}}}),t._v(" "),a("sub-panel-methods",{attrs:{method:t.method,bra:t.bra},on:{"update:method":function(e){t.method=e},"warn-about-method-bra":t.warnAboutMethodBra}}),t._v(" "),a("validation-button",{directives:[{name:"show",rawName:"v-show",value:t.method.type,expression:"method.type"}],staticClass:"yeti-validation--bottom",attrs:{"current-error":t.currentError,loading:t.promise},on:{click:t.compute}})],1),t._v(" "),a("panel",{ref:"panel1",attrs:{index:1,"active-tab":t.activeTab}},[a("sub-panel-course",{attrs:{map:t.yetiMap,features:t.features,"features-title":t.featuresTitle},on:{"update:featuresTitle":function(e){t.featuresTitle=e},"update:features-title":function(e){t.featuresTitle=e},gpx:t.onGpxLoaded}})],1)],1),t._v(" "),t._m(0)]),t._v(" "),a("yeti-map",{ref:"map",attrs:{gpx:t.gpx,"active-tab":t.activeTab,"valid-min-zoom":t.validFormData.minZoom,"map-zoom":t.mapZoom,"computed-extent":t.yetiExtent,"computed-data":t.yetiImage,mountains:t.mountains,"area-ok":t.areaOk,features:t.features,"features-title":t.featuresTitle},on:{"update:mapZoom":function(e){t.mapZoom=e},"update:map-zoom":function(e){t.mapZoom=e},"update:mountains":function(e){t.mountains=e},"update:areaOk":function(e){t.areaOk=e},"update:area-ok":function(e){t.areaOk=e},"update:features":function(e){t.features=e},"update:featuresTitle":function(e){t.featuresTitle=e},"update:features-title":function(e){t.featuresTitle=e}}})],1)])],1)},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"box yeti-logos"},[s("div",{staticClass:"columns is-mobile is-vcentered"},[s("div",{staticClass:"column has-text-centered"},[s("a",{attrs:{href:"http://www.ensg.eu"}},[s("picture",[s("source",{attrs:{srcset:a("e004"),type:"image/webp"}}),t._v(" "),s("source",{attrs:{srcset:a("0c6e"),type:"image/avif"}}),t._v(" "),s("img",{attrs:{src:a("aa66"),alt:"Logo ENSG",width:"120",loading:"lazy"}})])])]),t._v(" "),s("div",{staticClass:"column has-text-centered"},[s("a",{attrs:{href:"https://www.petzl.com/fondation/fondation-petzl?language=fr"}},[s("picture",[s("source",{attrs:{srcset:a("d315"),type:"image/webp"}}),t._v(" "),s("source",{attrs:{srcset:a("3d7f"),type:"image/avif"}}),t._v(" "),s("img",{attrs:{src:a("fc52"),alt:"Logo Fondation Petzl",width:"90",loading:"lazy"}})])])])])])}],r=a("bc3a"),n=a.n(r),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.document?a("div",{staticClass:"yeti-article"},[a("sub-panel-title",[t._v(t._s(t.title))]),t._v(" "),a("markdown-section",{attrs:{document:t.document,field:t.fields.description,"hide-title":""}})],1):t._e()},l=[],c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"columns is-mobile"},[a("div",{staticClass:"column"},[a("h2",{staticClass:"title is-3"},[t._t("default")],2)])])},u=[],m=(a("e375"),a("2877")),d={},h=Object(m["a"])(d,c,u,!1,null,"43c30758",null),v=h.exports,p=a("188b"),f=a("25c4"),g=a("7306"),_={components:{SubPanelTitle:v,MarkdownSection:g["a"]},props:{article:{type:Object,required:!0}},data(){return{promise:null}},computed:{id(){return this.article.id},title(){return this.article.title},document(){var t,e;return null!==(t=null===(e=this.promise)||void 0===e?void 0:e.data)&&void 0!==t?t:null},fields(){return f["a"].objectDefinitions.article.fields},lang(){return this.$language.current}},watch:{lang(){this.cookDocument()}},mounted(){this.cookDocument()},methods:{cookDocument(){p["a"].article.getCooked(this.id,this.$language.current).then(t=>{this.promise=t})}}},y=_,b=(a("e469"),Object(m["a"])(y,o,l,!1,null,"62129744",null)),w=b.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"yeti-panel",attrs:{role:"tabpanel",id:"panel"+t.index,"aria-labelledby":"tab"+t.index,hidden:t.activeTab!==t.index}},[t._t("default")],2)},C=[],k={props:{index:{type:Number,required:!0},activeTab:{type:Number,required:!0}}},E=k,N=(a("01d46"),Object(m["a"])(E,x,C,!1,null,"6a9ccc68",null)),F=N.exports,T=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"yeti-subpanel"},[a("sub-panel-title",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger level")])]),t._v(" "),a("div",{staticClass:"columns is-mobile"},[a("div",{staticClass:"column"},[a("div",{staticClass:"inputs-bra",class:{"inputs-bra-different":t.bra.isDifferent}},[a("svg",{attrs:{viewBox:"0 0 100 100",width:"120",height:"120"}},[a("polygon",{staticStyle:{fill:"none",stroke:"#000","stroke-miterlimit":"10"},attrs:{points:"2.2,89.5 97.5,89.5 62.7,11.9 48,32.9 31.8,25.5 "}}),t._v(" "),a("line",{directives:[{name:"show",rawName:"v-show",value:t.bra.isDifferent,expression:"bra.isDifferent"}],staticStyle:{fill:"none",stroke:"#000","stroke-miterlimit":"10"},attrs:{x1:"10",y1:"61.5",x2:"90",y2:"61.5"}})]),t._v(" "),a("div",{staticClass:"input-bra-high select is-small"},[a("select",{attrs:{id:"selectBra","aria-label":t.$gettext("High danger level from the avalanche bulletin")},domProps:{value:t.bra.high},on:{change:function(e){return t.onChange(e,"high")}}},[a("option",{attrs:{selected:""},domProps:{value:null}}),t._v(" "),a("option",{domProps:{value:1}},[t._v("1")]),t._v(" "),a("option",{domProps:{value:2}},[t._v("2")]),t._v(" "),a("option",{domProps:{value:3}},[t._v("3")]),t._v(" "),a("option",{domProps:{value:4}},[t._v("4")])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.bra.isDifferent,expression:"bra.isDifferent"}],staticClass:"input-bra-threshold control"},[a("label",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{for:"inputThreshold"}},[t._v("Altitude")]),t._v(" "),a("input",{staticClass:"input is-small",attrs:{id:"inputThreshold",type:"number",min:"0",max:"4800",step:"100",maxlength:"4"},domProps:{value:t.bra.altiThreshold},on:{change:function(e){return t.onChange(e,"altiThreshold")}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.bra.isDifferent,expression:"bra.isDifferent"}],staticClass:"input-bra-low select is-small"},[a("select",{attrs:{"aria-label":"$gettext('Low danger level from the avalanche bulletin')"},domProps:{value:t.bra.low},on:{change:function(e){return t.onChange(e,"low")}}},[a("option",{attrs:{selected:""},domProps:{value:null}}),t._v(" "),a("option",{domProps:{value:1}},[t._v("1")]),t._v(" "),a("option",{domProps:{value:2}},[t._v("2")]),t._v(" "),a("option",{domProps:{value:3}},[t._v("3")]),t._v(" "),a("option",{domProps:{value:4}},[t._v("4")])])])]),t._v(" "),a("div",[a("input-checkbox",{staticClass:"control--bradifferent",attrs:{value:t.bra.isDifferent},on:{input:function(e){return t.onChange(e,"isDifferent")}}},[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Different high/low danger?")])])],1)])]),t._v(" "),a("div",{staticClass:"yetimountains"},[a("div",[a("p",{staticClass:"yetimountains-title",on:{click:function(e){t.showMountainsList=!t.showMountainsList}}},[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Avalanche bulletins")]),t._v(" "),t.showVisibleMountains?a("counter",[t._v(t._s(t.countVisibleMountains))]):t._e(),t._v(" "),a("fa-icon",{staticClass:"yetimountains-arrow is-size-6 is-pulled-right has-cursor-pointer no-print",attrs:{icon:"angle-down",rotation:t.showMountainsList?180:void 0}})],1)]),t._v(" "),t.showMountainsList?a("div",[t.showVisibleMountains?a("div",[a("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"column yetiform-info"},[t._v("Get avalanche bulletins from Météo-France website")]),t._v(" "),a("dl",t._l(t.mountains.visibleMountains,(function(e,s){return a("div",{key:s},[a("dt",{staticClass:"yetimountains-listtitle"},[t._v("\n              "+t._s(s)+"\n            ")]),t._v(" "),a("div",{staticClass:"yetimountains-list"},t._l(e,(function(e){return a("dd",{key:e.title,staticClass:"yetimountains-listelement"},[a("a",{attrs:{href:e.urls[0].url,target:"_blank"}},[a("fa-icon",{attrs:{icon:"external-link-alt"}}),t._v("\n                  "+t._s(e.title)+"\n                ")],1)])})),0)])})),0)]):a("div",[a("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"column yetiform-info"},[t._v("Massifs could not be loaded")])])]):t._e()])],1)},S=[],D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("span",{staticClass:"yeti-counter",class:{"has-background-primary":t.isPrimary}},[t._t("default")],2)},$=[],L={props:{isPrimary:{type:Boolean,default:!1}}},M=L,P=(a("8309"),Object(m["a"])(M,D,$,!1,null,"79e0b738",null)),I=P.exports,O={components:{Counter:I,SubPanelTitle:v},props:{bra:{type:Object,default:null},mountains:{type:Object,required:!0}},data(){return{showMountainsList:!1}},computed:{showVisibleMountains(){return this.countVisibleMountains>=0},countVisibleMountains(){return this.mountains.visibleMountains?Object.values(this.mountains.visibleMountains).reduce((t,e)=>t+e.length,0):-1}},watch:{"bra.isDifferent":"checkBraIsDifferent"},methods:{onChange(t,e){const a="isDifferent"===e?t:t.target.value;this.$emit("update:bra",Object.assign(this.bra,{[e]:a}))},checkBraIsDifferent(){this.bra.isDifferent||(this.bra.low=null,this.bra.altiThreshold=null)}}},z=O,A=(a("b636"),Object(m["a"])(z,T,S,!1,null,"df986eea",null)),G=A.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"yeti-subpanel"},[a("sub-panel-title",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Route")])]),t._v(" "),t.features.length?a("div",[a("div",{staticClass:"columns is-mobile"},[a("div",{staticClass:"column"},[a("p",{staticClass:"features-title"},[a("icon-route",{staticClass:"icon document-icon"}),t._v(" "),a("fa-icon",{staticClass:"icon edit-icon",attrs:{icon:"pen"}}),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.hasFeaturesTitle,expression:"!hasFeaturesTitle"},{name:"translate",rawName:"v-translate"}],staticClass:"features-title-text features-title-placeholder",on:{click:t.onEditNewFeaturesTitle}},[t._v("\n            Add title…\n          ")]),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.hasFeaturesTitle,expression:"hasFeaturesTitle"}],ref:"featuresTitle",staticClass:"features-title-text features-title-content",attrs:{tabindex:"0",contenteditable:"",spellcheck:"false"},on:{blur:t.onEditFeaturesTitle,keypress:function(t){if(!t.type.indexOf("key")&&13!==t.keyCode)return null;t.preventDefault()}}},[t._v(t._s(t.editableFeaturesTitle))])],1)]),t._v(" "),a("div",{staticClass:"column is-narrow"},[a("button",{staticClass:"button is-secondary is-small",on:{click:t.onRemoveFeatures}},[a("fa-icon",{staticClass:"trash-icon",attrs:{icon:"trash"}}),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Delete route")])],1)])]),t._v(" "),a("div",{staticClass:"ml-5 mb-5"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"yetiform-info is-italic is-marginless"},[t._v("Lines chunks")]),t._v(" "),a("features-list",{attrs:{features:t.features,map:t.map}})],1),t._v(" "),a("sub-panel-title",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Export")])]),t._v(" "),a("div",{staticClass:"columns is-vcentered is-mobile"},[a("div",{staticClass:"column"},[a("ul",{staticClass:"form-export"},t._l(t.formats,(function(e){return a("li",{key:e,staticClass:"control is-flex"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.format,expression:"format"}],staticClass:"is-checkradio is-primary",attrs:{id:"format"+e,type:"radio",name:"exportFormat"},domProps:{value:e,checked:t._q(t.format,e)},on:{change:function(a){t.format=e}}}),t._v(" "),a("label",{attrs:{for:"format"+e}},[t._v(t._s(e))])])})),0)]),t._v(" "),a("div",{staticClass:"column is-narrow"},[a("button",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"button is-primary",on:{click:t.downloadCourse}},[t._v("Export route")])])]),t._v(" "),a("div",{staticClass:"yetiform-note mt-5"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Drawing tips")]),t._v(" "),a("ul",{staticClass:"content-ul"},[a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"translate-context":"yeti"}},[t._v("Draw")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("new lines chunks")])]),t._v(" "),a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"translate-context":"yeti"}},[t._v("Delete")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("last point with the Backspace key")])])]),t._v(" "),a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("On a drawn line")]),t._v(" "),a("ul",{staticClass:"content-ul"},[a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"translate-context":"yeti"}},[t._v("Edit")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("points by moving them")])]),t._v(" "),a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}],attrs:{"translate-context":"yeti"}},[t._v("Create")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("a new point on an existing line")])]),t._v(" "),a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Delete a point")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("with Alt + clic")])])]),t._v(" "),a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("From the interface")]),t._v(" "),a("ul",{staticClass:"content-ul"},[a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Delete a line chunk")])]),t._v(" "),a("li",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Delete route")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("to start or load a new one")])])])])],1):a("div",[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("No route right now")]),t._v(" "),a("div",{staticClass:"load-gpx"},[a("button",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"button is-primary",class:{"is-loading":t.loading},attrs:{disabled:t.loading},on:{click:t.onLoadGpx}},[t._v("\n        Upload a GPS track\n      ")]),t._v(" "),a("div",{staticClass:"control upload-button"},[a("input",{ref:"gpxFileInput",attrs:{type:"file",accept:".gpx"},on:{change:t.uploadGpx}})]),t._v(" "),a("div",{staticClass:"yetiform-note mt-5"},[a("p",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Draw right on the map")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("to start a new route")])])])])])],1)},B=[],Y=a("b166"),R=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"featureslist"},t._l(t.features,(function(e,s){return a("li",{key:s,staticClass:"featureslist-item tag",on:{mouseenter:function(a){return t.showFeature(e)},mouseleave:function(a){return t.hideFeature(e)}}},[a("span",[t._v(t._s(t.nbPointsOnFeature(e))+" points")]),t._v(" "),a("button",{staticClass:"delete is-small",on:{click:function(a){return t.removeFeature(e)}}},[t._v("x")])])})),0)},Z=[],V={props:{map:{type:Object,default:null},features:{type:Array,required:!0}},methods:{removeFeature(t){this.map.removeFeature(t)},showFeature(t){t.setStyle(t.get("highlightedStyle"))},hideFeature(t){t.setStyle(t.get("normalStyle"))},nbPointsOnFeature(t){return t.getGeometry().getCoordinates().length}}},q=V,K=(a("f6bf"),Object(m["a"])(q,R,Z,!1,null,"6c22161a",null)),W=K.exports,J=a("dac7"),U=a("9944"),X={components:{FeaturesList:W,SubPanelTitle:v},props:{map:{type:Object,default:null},features:{type:Array,default:null},featuresTitle:{type:String,default:null}},data(){return{editableFeaturesTitle:"",newFeaturesTitle:!1,loading:!1,formats:["GPX","KML"],format:"GPX"}},computed:{hasFeaturesTitle(){return!(!this.editableFeaturesTitle.length&&!this.newFeaturesTitle)}},watch:{featuresTitle(){this.editableFeaturesTitle=this.featuresTitle}},mounted(){this.editableFeaturesTitle=this.featuresTitle},methods:{onEditFeaturesTitle(t){t.target.innerText.length||(this.newFeaturesTitle=!1),this.$emit("update:featuresTitle",t.target.innerText)},onEditNewFeaturesTitle(){this.newFeaturesTitle=!0,this.$nextTick(()=>{this.$refs.featuresTitle.focus()})},onLoadGpx(){this.$refs.gpxFileInput.click()},onRemoveFeatures(){this.map.removeFeatures()},uploadGpx(t){this.loading=!0;const e=new FileReader;e.onload=()=>{this.loading=!1,this.$emit("gpx",e.result)},e.readAsText(t.target.files[0]),this.$refs.gpxFileInput.value="",this.$emit("gpx",null)},downloadCourse(){"GPX"===this.format?this.downloadFeatures(new J["a"].format.GPX,".gpx","application/gpx+xml"):"KML"===this.format&&this.downloadFeatures(new J["a"].format.KML,".kml","application/vnd.google-earth.kml+xml")},downloadFeatures(t,e,a){const s=this.features;s[0].set("name",this.featuresTitle);const i=this.setFilename(e),r=t.writeFeatures(s,{featureProjection:"EPSG:3857"});U["a"].download(r,i,a+";charset=utf-8")},setFilename(t){return Object(Y["a"])(new Date,"yyyy-MM-dd_HH-mm-ss")+t}}},H=X,Q=(a("873e"),Object(m["a"])(H,j,B,!1,null,"05c9c091",null)),tt=Q.exports,et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"yeti-subpanel"},[a("sub-panel-title",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Methods")])]),t._v(" "),a("div",{staticClass:"columns is-mobile yetitabs"},t._l(Object.keys(t.methods),(function(e){return a("div",{key:e,staticClass:"column yetitab"},[a("div",{staticClass:"control yetitab-control",class:{"yetitab-control--selected":t.method.type===e}},[a("input",{staticClass:"is-checkradio is-primary",attrs:{id:"c2c-method-"+e,type:"radio",name:"method",disabled:"mrd"===e&&(4==t.bra.high||4==t.bra.low)},domProps:{value:e,checked:e===t.method.type},on:{change:function(e){return t.onChange(e,"type")}}}),t._v(" "),a("label",{staticClass:"yetitab-label",attrs:{for:"c2c-method-"+e},on:{click:function(a){return t.warnAboutMethodBra(e)}}},[t._v("\n          "+t._s(t.methods[e][0])+"\n          "),a("span",{staticClass:"yetiform-info"},[t._v(t._s(t.methods[e][1]))])])])])})),0),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mrd"==t.method.type,expression:"method.type == 'mrd'"}]},[a("p",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("With the")]),t._v(" "),a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Beginner Reduction Method")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        (MRD), you do not have to enter any parameters other than the danger level(s) given by the avalanche bulletin.\n      ")])]),t._v(" "),a("div",{staticClass:"yetiform-note"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        As the name suggests, this method is intended for beginners. Therefore, the safety margin must be particularly\n        important. No parameter other than the danger level is specified. Orientation is ignored.\n      ")])]),t._v(" "),a("table",{staticClass:"yetiform-danger"},[a("tr",[t._m(0),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - low")])]),t._v(" "),a("td",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 40°")])]),t._v(" "),a("tr",[t._m(1),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - moderate")])]),t._v(" "),a("td",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 35°")])]),t._v(" "),a("tr",{staticClass:"multiline"},[t._m(2),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - considerable")])]),t._v(" "),a("td",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 30°")]),t._v(" "),a("br"),t._v(" "),a("small",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("including dominant slopes")])])]),t._v(" "),a("tr",[t._m(3),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - high to very high")])]),t._v(" "),a("td",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I choose to cancel the outing")])])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mre"==t.method.type,expression:"method.type == 'mre'"}]},[a("p",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("With the")]),t._v(" "),a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Elementary Reduction Method")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        (MRE), you can enter the sectors of the compass rose that are reported as critical in the avalanche bulletin.\n      ")])]),t._v(" "),a("input-orientation",{staticClass:"has-text-centered",attrs:{value:t.method.orientation},on:{input:function(e){return t.onChange(e,"orientation")}}}),t._v(" "),0!=t.method.orientation.length?a("p",{staticClass:"yetiform-info"},[a("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"tr1"},[t._v("Orientations")]),t._v(": "+t._s(t.method.orientation.join(", "))+"\n    ")]):a("p",{staticClass:"yetiform-info"},[a("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"tr2"},[t._v("No orientation selected")])]),t._v(" "),a("div",{staticClass:"yetiform-note"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        Danger level from the avalanche bulletin applies to all orientations. The compass rose distinguishes the most\n        critical sectors presenting an increased risk.\n      ")])]),t._v(" "),a("table",{staticClass:"yetiform-danger"},[a("tr",{staticClass:"multiline"},[t._m(4),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - low")])]),t._v(" "),a("td",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Stay careful while skiing")]),t._v(" "),a("br"),t._v(" "),a("small",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("risk of a rough fall on hard snow")])])]),t._v(" "),a("tr",[t._m(5),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - moderate")])]),t._v(" "),a("td",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 40°")])]),t._v(" "),a("tr",{staticClass:"multiline"},[t._m(6),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - considerable")])]),t._v(" "),a("td",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 35°")]),t._v(" "),a("br"),t._v(" "),a("small",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("including dominant slopes")])])]),t._v(" "),a("tr",{staticClass:"multiline"},[t._m(7),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - high")])]),t._v(" "),a("td",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I must not use slopes > 30°")]),t._v(" "),a("br"),t._v(" "),a("small",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("including dominant slopes")])])]),t._v(" "),a("tr",[t._m(8),t._v(" "),a("td",[a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger rating - very high")])]),t._v(" "),a("td",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("I choose to cancel the outing")])])])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mrp"==t.method.type,expression:"method.type == 'mrp'"}]},[a("p",[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("With the")]),t._v(" "),a("strong",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Professional Reduction Method")]),t._v(" "),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        (MRP), you can refine the hazard potential, set group size and any precautionary measures being considered.\n      ")])]),t._v(" "),a("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"title is-3"},[t._v("Hazard potential")]),t._v(" "),a("ul",{staticClass:"potential-danger-labels has-text-black"},t._l(t.potentialDangerLabels,(function(e){return a("li",{key:e.text,staticClass:"potential-danger-label is-size-5",attrs:{disabled:!t.bra.high||e.text<t.potentialDangerOptions.min||e.text>t.potentialDangerOptions.max,selected:t.method.potentialDanger==e.text},on:{click:function(a){return t.onChange(e.text,"potentialDanger")}}},[a("span",{class:{"is-size-3 has-text-weight-bold":e.val}},[t._v("\n          "+t._s(e.text)+"\n        ")])])})),0),t._v(" "),t.method.potentialDanger?a("p",{staticClass:"yetiform-info"},[a("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"tr1"},[t._v("Hazard potential:")]),t._v("\n      "+t._s(t.method.potentialDanger)+"\n      ("),a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Danger level:")]),t._v(" "+t._s(t.bra.high)+")\n    ")]):a("p",{staticClass:"yetiform-info"},[a("span",{directives:[{name:"translate",rawName:"v-translate"}],key:"tr2"},[t._v("No selected hazard potential. Set danger level first.")])]),t._v(" "),a("div",{staticClass:"yetiform-note"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n        The hazard potential is calculated from the danger level of the avalanche bulletin. It can be fine-tuned by\n        selecting a potential within the danger level’s corresponding range. For example: the avalanche bulletin\n        evokes a danger 3 just after a period in danger 4. We can then indicate a hazard potential of 12 instead of 8.\n      ")])]),t._v(" "),a("p",[a("input-checkbox",{attrs:{value:t.method.wetSnow},on:{input:function(e){return t.onChange(e,"wetSnow")}}},[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Wet snow: orientation not taken into account")])])],1),t._v(" "),a("div",{staticClass:"yetiform-note"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Be careful, in wet snow, no factor to reduce orientation or attendance can be applied.")])]),t._v(" "),a("h3",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"title is-3"},[t._v("Group")]),t._v(" "),a("ul",t._l(t.groupSizes,(function(e,s){return a("li",{key:s,staticClass:"control"},[a("input",{staticClass:"is-checkradio is-primary",attrs:{id:"c2c-group-size-"+s,type:"radio",name:"groupSize"},domProps:{value:e.value,checked:e.value===t.method.groupSize},on:{change:function(e){return t.onChange(e,"groupSize")}}}),t._v(" "),a("label",{attrs:{for:"c2c-group-size-"+s}},[t._v(t._s(e.text))])])})),0),t._v(" "),a("div",{staticClass:"yetiform-note"},[a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Group size")]),t._v(" "),a("ul",{staticClass:"content-ul"},[a("li",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Large group = 5 people and more")]),t._v(" "),a("li",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Small group = 2 to 4 people")])]),t._v(" "),a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Load shedding distance")]),t._v(" "),a("ul",{staticClass:"content-ul"},[a("li",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("10 meters minimum while ascending")]),t._v(" "),a("li",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("50 meters while descending")])])]),t._v(" "),a("p",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("\n      The “slope traveled frequently” factor is not taken into account by the application, as it is often difficult to\n      ascertain when preparing for an outing.\n    ")])])],1)},at=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level1",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level2",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level3",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level4",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level1",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level2",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level3",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level4",loading:"lazy"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("td",[s("img",{attrs:{src:a("60a4")+"#level4",loading:"lazy"}})])}];const st={min:1,max:16,bra:[{min:1,max:2,val:2},{min:3,max:6,val:4},{min:6,max:12,val:8},{min:13,max:16,val:16}]};var it={components:{SubPanelTitle:v},props:{method:{type:Object,default:null},bra:{type:Object,default:null}},data(){return{methods:{mrd:["MRD",this.$gettext("Beginner")],mre:["MRE",this.$gettext("Elementary")],mrp:["MRP",this.$gettext("Expert")]},groupSizes:[{value:1,text:this.$gettext("No reduction factor")},{value:2.1,text:this.$gettext("Large group with load shedding distance")},{value:2.2,text:this.$gettext("Small group without distance")},{value:3,text:this.$gettext("Small group with load shedding distance")}]}},computed:{potentialDangerLabels(){const t=[];for(let e=st.min;e<=st.max;e++){const a={text:e};2!==e&&4!==e&&8!==e&&16!==e||(a.val=e),t.push(a)}return t},potentialDangerOptions(){return this.bra.high?st.bra[this.bra.high-1]:{val:void 0,min:1,max:16}}},watch:{"bra.high":"onBraChange"},methods:{onChange(t,e){let a=null;a="orientation"===e||"wetSnow"===e||"potentialDanger"===e?t:t.target.value,this.$emit("update:method",Object.assign(this.method,{[e]:a}))},warnAboutMethodBra(t){this.$emit("warn-about-method-bra",t)},onBraChange(){this.onChange(this.potentialDangerOptions.val,"potentialDanger")}}},rt=it,nt=(a("2eb6"),Object(m["a"])(rt,et,at,!1,null,"b13e18f2",null)),ot=nt.exports,lt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"column pb-0 mb-0 tabs is-boxed yetitabs"},[a("ul",{attrs:{role:"tablist"}},t._l(t.tabs,(function(e,s){return a("li",{key:e,class:{"is-active":t.activeTab===s},attrs:{role:"presentation"}},[a("a",{ref:"tab",refInFor:!0,staticClass:"yetitabs-link",attrs:{role:"tab",href:"#panel"+s,id:"tab"+s,"aria-selected":t.activeTab===s,tabindex:t.activeTab!==s&&-1},on:{click:function(e){return e.preventDefault(),t.setActiveTab(s)},keydown:function(e){return t.setActiveTabKeyboard(e,s)}}},[t._v("\n        "+t._s(e)+" "),1===s&&t.hasFeatures?a("counter",{attrs:{"is-primary":""}},[t._v("1")]):t._e()],1)])})),0)])},ct=[],ut={components:{Counter:I},props:{tabs:{type:Array,required:!0},activeTab:{type:Number,required:!0},hasFeatures:{type:Boolean,default:!1}},methods:{setActiveTab(t){this.$refs.tab[t].focus(),this.$emit("update:activeTab",t)},setActiveTabKeyboard(t,e){const a=37,s=39,i=40;let r=t.which===a?e-1:t.which===s?e+1:t.which===i?"down":null;null!==r&&(t.preventDefault(),"down"===r?this.$parent.$refs["panel"+e].$el.focus():this.tabs[r]&&this.setActiveTab(r))}}},mt=ut,dt=(a("4508"),Object(m["a"])(mt,lt,ct,!1,null,"c6260810",null)),ht=dt.exports,vt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"columns"},[a("div",{staticClass:"column has-text-right"},[a("button",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"button is-primary",class:{"is-loading":t.loading},attrs:{disabled:t.loading,tabindex:t.tabindex},on:{click:function(e){return t.$emit("click")}}},[t._v("\n      Compute risk\n    ")]),t._v(" "),t.currentError?a("p",{staticClass:"yetiform-error"},[a("span",[t._v("\n        "+t._s(t.currentError)+"\n      ")])]):t._e()])])},pt=[],ft={props:{currentError:{type:String,default:""},loading:{type:[Promise,Object],default:null},tabindex:{type:String,default:"0"}}},gt=ft,_t=(a("efa0"),Object(m["a"])(gt,vt,pt,!1,null,"ad96ba08",null)),yt=_t.exports,bt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"column map-container"},[a("div",{staticClass:"legend"},[a("div",[a("div",{staticClass:"legend-button is-pulled-right ol-control"},[a("button",{attrs:{type:"button"},on:{click:function(e){t.showLegend=!t.showLegend}}},[a("span",{directives:[{name:"translate",rawName:"v-translate"}]},[t._v("Legend")])])])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.showLegend,expression:"showLegend === true"}],staticClass:"legend-content"},[t.mapLegend?a("div",[a("ul",t._l(t.mapLegend.items,(function(e,s){return a("li",{key:s},[a("span",{staticClass:"legend-color",style:"background:"+e.color}),t._v(" "),a("span",[t._v(t._s(t.$gettext(e.text["en"])))])])})),0),t._v(" "),a("p",{staticClass:"is-size-6 is-italic"},[t._v(t._s(t.$gettext(t.mapLegend.comment["en"])))])]):a("p",{directives:[{name:"translate",rawName:"v-translate"}],staticClass:"is-italic"},[t._v("Legend will appear automatically with the generated image")])])]),t._v(" "),t.yetiLayerLoaded?a("div",{staticClass:"ol-control opacity"},[a("div",{staticClass:"opacity-slider"},[a("vue-slider",{attrs:{min:0,max:1,interval:.01,tooltip:"none",direction:"btt","rail-style":{background:"rgba(0,0,0,.25)"},"process-style":{background:"white"}},on:{change:t.onUpdateOpacityYetiLayer},model:{value:t.opacityYetiLayer,callback:function(e){t.opacityYetiLayer=e},expression:"opacityYetiLayer"}})],1)]):t._e(),t._v(" "),a("map-view",{ref:"map",attrs:{"show-recenter-on":""}})],1)},wt=[];a("5319"),a("24df");const xt="RGE ALTI®",Ct=.75,kt="/mountains_WGS84.json",Et="https://api.ensg.eu/yeti-extent",Nt=new J["a"].style.Style({stroke:new J["a"].style.Stroke({color:"yellow",width:3})}),Ft=[new J["a"].style.Style({stroke:new J["a"].style.Stroke({color:"rgba(255, 255, 0, .5)",width:8}),zIndex:1}),new J["a"].style.Style({stroke:new J["a"].style.Stroke({color:"red",width:3}),zIndex:1})];var Tt={components:{VueSlider:()=>a.e("slider").then(a.t.bind(null,"4971",7))},props:{activeTab:{type:Number,required:!0},validMinZoom:{type:Number,required:!0},mapZoom:{type:Number,required:!0},computedExtent:{type:Array,required:!0},computedData:{type:String,default:null},mountains:{type:Object,required:!0},areaOk:{type:Boolean,required:!0},features:{type:Array,required:!0},gpx:{type:String,default:null},featuresTitle:{type:String,required:!0}},data(){return{featuresTitleFromSource:null,promiseDocument:null,yetiLayerLoaded:!1,showLegend:void 0,mapLegend:null,opacityYetiLayer:Ct,areas:[]}},computed:{localFeaturesTitle(){return this.featuresTitleFromSource?this.featuresTitleFromSource:this.features.length?this.featuresTitle:null},areasLayerStyle(){const t=2,e=4,a=Math.max(0,Math.min(this.mapZoom-6,t)),s=Math.max(0,Math.min(this.mapZoom-6,e))/4,i=6*s;return new J["a"].style.Style({stroke:new J["a"].style.Stroke({color:"hsla(30, 100%, 40%,"+s+")",width:a,lineDash:[i]})})}},watch:{gpx(){this.gpx&&this.addFeaturesFromGpx(this.gpx)},localFeaturesTitle(){this.$emit("update:featuresTitle",this.localFeaturesTitle)},activeTab(){0===this.activeTab?(this.drawInteraction.setActive(!1),this.modifyInteraction.setActive(!1),this.snapInteraction.setActive(!1)):(this.drawInteraction.setActive(!0),this.modifyInteraction.setActive(!0),this.snapInteraction.setActive(!0))},computedData(){this.drawYetiImage()},computedExtent(){this.drawExtent(this.computedExtent)}},mounted(){this.yetiLayer=new J["a"].layer.Image({source:new J["a"].source.ImageStatic({url:null,imageExtent:J["a"].extent.createEmpty()}),opacity:this.opacityYetiLayer}),this.extentLayer=new J["a"].layer.Vector({source:new J["a"].source.Vector,style:[new J["a"].style.Style({fill:new J["a"].style.Fill({color:"hsla(30, 100%, 60%, .45)"})}),new J["a"].style.Style({stroke:new J["a"].style.Stroke({color:"hsla(30, 100%, 40%, 1)",width:2}),geometry:t=>new J["a"].geom.Polygon([t.getGeometry().getCoordinates()[1]])})]}),this.areasLayer=new J["a"].layer.Vector({renderMode:"image",source:new J["a"].source.Vector,style:this.areasLayerStyle}),this.featuresLayer=new J["a"].layer.Vector({source:new J["a"].source.Vector,style:Nt}),this.featuresLayerSource=this.featuresLayer.getSource(),this.mapView=this.$refs.map,this.map=this.$refs.map.map,this.view=this.map.getView(),this.map.addLayer(this.areasLayer),this.map.addLayer(this.yetiLayer),this.map.addLayer(this.extentLayer),this.map.addLayer(this.featuresLayer);const t=this.$route.params.document_id,e=this.$language.current;t&&p["a"]["route"].getCooked(t,e).then(this.addFeaturesFromDocument),this.addEvents(),this.addInteractions(),n.a.get(kt).then(this.onMountainsResult),n.a.get(Et).then(this.onAreasResult)},methods:{getExtent(t){return this.mapView.getExtent(t)},clearLayers(){this.yetiLayer.setSource(null),this.yetiLayerLoaded=!1,this.extentLayer.getSource().clear()},addEvents(){this.map.un("pointermove",this.mapView.onPointerMove),this.map.un("click",this.mapView.onClick),this.map.on("moveend",this.onMapMoveEnd),this.featuresLayerSource.on("addfeature",this.onFeature)},addInteractions(){const t=this.featuresLayerSource;this.modifyInteraction=new J["a"].interaction.Modify({source:t}),this.map.addInteraction(this.modifyInteraction),this.drawInteraction=new J["a"].interaction.Draw({source:t,type:"LineString"}),this.map.addInteraction(this.drawInteraction),this.snapInteraction=new J["a"].interaction.Snap({source:t}),this.map.addInteraction(this.snapInteraction),this.drawInteraction.on("drawstart",this.onDrawStart),this.drawInteraction.on("drawend",this.onDrawEnd),this.modifyInteraction.on("modifyend",this.onModifyEnd),this.drawInteraction.setActive(!1),this.modifyInteraction.setActive(!1),this.snapInteraction.setActive(!1)},onMapMoveEnd(t){const e=Math.floor(10*t.map.getView().getZoom())/10;this.$emit("update:mapZoom",e),this.setVisibleMountains(),this.isAreaOK(),this.areasLayer.setStyle(this.areasLayerStyle)},fitMapToFeatures(){let t=J["a"].extent.createEmpty();J["a"].extent.extend(t,this.featuresLayerSource.getExtent()),this.view.fit(t,{size:this.map.getSize()}),this.view.setZoom(Math.max(this.validMinZoom,this.view.getZoom()))},addFeaturesFromGpx(t){this.promiseDocument=null,this.featuresLayerSource.clear(!0),this.loadingExternalFeatures=!0;const e=new J["a"].format.GPX,a=e.readFeatures(t,{featureProjection:"EPSG:3857"});a.map(this.addFeature),this.featuresTitleFromSource=this.getFeaturesTitleFromGpx(a),this.loadingExternalFeatures=!1,this.emitFeaturesEvent(),this.fitMapToFeatures()},addFeaturesFromDocument(t){this.loadingExternalFeatures=!0;const e=t.data.geometry.geom_detail,a=(new J["a"].format.GeoJSON).readFeature(e);this.addFeature(a),this.featuresTitleFromSource=this.getFeaturesTitleFromDocument(t),this.loadingExternalFeatures=!1,this.emitFeaturesEvent(),this.fitMapToFeatures()},addFeature(t){if("MultiLineString"===t.getGeometry().getType()){const e=t.getGeometry().getLineStrings();e.map(t=>new J["a"].Feature({geometry:t})).map(this.addFeature)}else{const e=t.getGeometry().getCoordinates().length;e>=2&&this.featuresLayerSource.addFeature(t)}},removeFeature(t){let e=!(1===this.featuresLayerSource.getFeatures().length&&!confirm(this.$gettext("Confirm delete")));e&&(this.featuresLayerSource.removeFeature(t),this.emitFeaturesEvent())},removeFeatures(){confirm(this.$gettext("Confirm delete"))&&(this.featuresLayerSource.clear(!0),this.emitFeaturesEvent())},emitFeaturesEvent(){const t=this.getFeaturesLayerFeatures();this.$emit("update:features",t),0===t.length&&(this.featuresTitleFromSource=null,this.$route.params.document_id&&this.$router.replace({path:"/"+this.$route.name}))},getFeaturesLayerFeatures(){return this.featuresLayerSource.getFeatures()},getFeaturesTitleFromGpx(t){if(t&&t.length){const e=t[0].getProperties();return e.name?e.name:this.$gettext("GPX file")}},getFeaturesTitleFromDocument(t){return this.$documentUtils.getDocumentTitle(t.data)},onFeature(t){t.feature.set("highlightedStyle",Ft),this.loadingExternalFeatures||this.emitFeaturesEvent()},onDrawStart(){document.addEventListener("keydown",this.onKeyWhileDrawing),document.addEventListener("keypress",this.onKeyWhileDrawing)},onDrawEnd(){document.removeEventListener("keydown",this.onKeyWhileDrawing),document.removeEventListener("keypress",this.onKeyWhileDrawing)},onModifyEnd(){this.emitFeaturesEvent()},onKeyWhileDrawing(t){t.preventDefault(),"Backspace"===t.key&&this.drawInteraction.removeLastPoint()},drawYetiImage(){const t=(new DOMParser).parseFromString(this.computedData,"application/xml"),e=t.getElementsByTagName("wps:ComplexData")[0].textContent,a=t.getElementsByTagName("wps:ComplexData")[1].textContent,s=J["a"].proj.transformExtent(a.split(",").map(Number),"EPSG:4326","EPSG:3857");this.yetiLayer.setSource(new J["a"].source.ImageStatic({imageLoadFunction(t){t.getImage().src="data:image/png;base64,"+e},attributions:xt,imageExtent:s})),this.yetiLayerLoaded=!0,this.setLegend(t)},setLegend(t){this.mapLegend=JSON.parse(t.getElementsByTagName("wps:ComplexData")[2].textContent),this.mapLegend.items.forEach(t=>{t.color=`rgb(${t.color[0]}, ${t.color[1]}, ${t.color[2]})`})},drawExtent(t){const e=J["a"].extent.buffer(t,Math.max(t[2]-t[0],t[3]-t[1])/10),a=new J["a"].Feature(new J["a"].geom.Polygon([this.toLinearRing(e),this.toLinearRing(t)]));this.extentLayer.getSource().addFeature(a)},toLinearRing(t){const e=t[0],a=t[1],s=t[2],i=t[3];return[[e,a],[e,i],[s,i],[s,a],[e,a]]},onUpdateOpacityYetiLayer(){this.yetiLayer.setOpacity(this.opacityYetiLayer)},onMountainsResult(t){const e=t.data;let a=(new J["a"].format.GeoJSON).readFeatures(e).map(t=>t.getProperties());this.allMountains=this.sortMountainsByMassif(a),this.setVisibleMountains()},sortMountainsByMassif(t){const e={};for(let a=0;a<t.length;a++)e[t[a].mountain]||(e[t[a].mountain]=[]),e[t[a].mountain].push(t[a]);t=e;for(const a in t)t[a].sort((t,e)=>t.title<e.title?-1:e.title>t.title?1:0);return t},setVisibleMountains(){if(!this.allMountains)return;const t=this.getExtent("EPSG:4326"),e=Object.assign({},this.allMountains);for(const s in e)e[s]=e[s].filter(e=>{const a=e.geometry;return a.intersectsExtent(t)}),0===e[s].length&&delete e[s];const a={visibleMountains:e};this.$emit("update:mountains",a)},onAreasResult(t){const e=t.data,a=(new J["a"].format.GeoJSON).readFeatures(e);a[0].getGeometry().transform("EPSG:4326","EPSG:3857"),this.areas=a.map(t=>t.getProperties());const s=a[0].getGeometry().getCoordinates(),i=[];for(let n=0;n<s.length;n++)i.push(...s[n]);const r=[];for(let n=0;n<i.length;n++)for(let t=0;t<i[n].length-1;t++)r.push(new J["a"].Feature(new J["a"].geom.LineString([i[n][t],i[n][t+1]])));this.areasLayer.getSource().addFeatures(r),this.isAreaOK()},isAreaOK(){const t=this.getExtent("EPSG:3857");let e=!0;for(const a in this.areas){const s=this.areas[a].geometry;if(s.intersectsExtent(t))break;e=!1}this.$emit("update:areaOk",e)}}},St=Tt,Dt=(a("57ee"),Object(m["a"])(St,bt,wt,!1,null,"28368954",null)),$t=Dt.exports;const Lt="https://api.ensg.eu/yeti-wps?request=Execute&service=WPS&version=1.0.0&identifier=Yeti&datainputs=",Mt={minZoom:13,braMaxMrd:3};var Pt={name:"Yeti",components:{YetiArticle:w,Panel:F,SubPanelBra:G,SubPanelCourse:tt,SubPanelMethods:ot,Tabs:ht,ValidationButton:yt,YetiMap:$t},data(){return{showDisclaimer:!1,checkDisclaimer:!1,articles:{faq:{id:1257569,title:"FAQ"},disclaimer:{id:1257571,title:this.$gettext("Disclaimer")}},yetiMap:null,tabs:[this.$gettext("Compute"),this.$gettext("Outing")],activeTab:0,errors:{area:{simple:this.$gettext("Area not covered"),full:this.$gettext("Current map view is not covered by YETI. Only french mountains are as of now (determined by a dashed stroke).")},method:{simple:this.$gettext("Missing method"),full:this.$gettext("Please select a method before computing.")},method_bra:{simple:this.$gettext("Conflicting method and danger"),full:this.$gettext("The MRD method (beginner) is allowed when danger is 3 maximum. Choose another method: MRE or MRP.")},bra:{simple:this.$gettext("Missing danger level"),full:this.$gettext("Please set danger level as specified on avalanche bulletin for the specific area.")},altitude:{simple:this.$gettext("Missing altitude"),full:this.$gettext("Altitude is mandatory when danger high and low are different. Please set altitude as specified on avalanche bulletin for the specific area.")},zoom:{simple:this.$gettext("Area too large"),full:this.$gettext("Current map view is too large. Please zoom to level "+Mt.minZoom)},ok:this.$gettext("Seems fine! :)"),yeti:this.$gettext("Service is inactive right now"),yeti_prefix:"YETI Service: ",yeti_unauthorized:this.$gettext("You have to be authorized. Please contact administrators of the service if interested.")},validFormData:Mt,bra:{high:null,low:null,altiThreshold:null,isDifferent:!1},method:{type:null,orientation:[],potentialDanger:void 0,wetSnow:!1,groupSize:1},mapZoom:0,formError:void 0,currentError:void 0,promise:null,yetiImage:null,yetiLayer:null,yetiExtent:[],features:[],gpx:null,featuresTitle:this.$gettext("New route"),mountains:{},areaOk:!0}},computed:{mrdIsNotApplicable(){return this.isBraMax&&"mrd"===this.method.type},isBraMax(){return this.bra.high>this.validFormData.braMaxMrd||this.bra.low>this.validFormData.braMaxMrd},isValidMapZoom(){return this.mapZoom>=this.validFormData.minZoom},hasFeatures(){return!!this.features.length}},watch:{"bra.low":"check","bra.altiThreshold":"check","bra.isDifferent":"check","method.type":"check","method.potentialDanger":"check",mapZoom:"check",areaOk:"check",featuresTitle(t){null===t&&(this.featuresTitle=this.$gettext("New route"))}},created(){this.$localStorage.get("yeti-disclaimer")||(this.showDisclaimer=!0)},mounted(){this.yetiMap=this.$refs.map,this.check()},methods:{check(){this.areaOk?this.isValidMapZoom?this.bra.high?this.bra.low&&this.bra.high!==this.bra.low&&!this.bra.altiThreshold?this.formError="altitude":this.method.type?this.mrdIsNotApplicable?this.formError="method_bra":!this.bra.isDifferent||this.bra.low&&this.bra.high?this.formError=null:this.formError="bra":this.formError="method":this.formError="bra":this.formError="zoom":this.formError="area",this.mrdIsNotApplicable&&(this.method.type=null),this.setCurrentError()},warnAboutMethodBra(t){"mrd"===t&&this.isBraMax&&window.alert(this.errors.method_bra.full)},setCurrentError(){this.formError?(this.currentError=this.errors[this.formError]["simple"],"zoom"===this.formError&&(this.currentError+=" ("+this.$gettext("current zoom:")+" "+this.mapZoom+" "+this.$gettext("on")+" "+this.validFormData.minZoom+")")):this.currentError=this.errors["ok"]},compute(){if(this.formError)return void window.alert(this.errors[this.formError]["full"]);const t=this.$refs.map.getExtent("EPSG:3857"),e=this.extendExtent(t),a=this.getYetiUrl(e);this.yetiMap.clearLayers(),this.promise=n.a.get(a).then(t=>this.onYetiResult(t,e)).catch(this.onYetiError)},extendExtent(t){const e=Math.min(.5,(this.mapZoom-this.validFormData.minZoom)/6),a=Math.max(t[2]-t[0],t[3]-t[1])*e;return J["a"].extent.buffer(t,a)},onYetiResult(t,e){this.yetiImage=t.data,this.yetiExtent=e,this.promise=null},onYetiError(t){this.promise=null;let e=this.errors["yeti"];if(400===t.response.status){const a=(new DOMParser).parseFromString(t.response.data,"text/xml");e=[...a.getElementsByTagName("ExceptionText")].map(t=>t.textContent).join(" ")}403===t.response.status&&(e=this.errors["yeti_unauthorized"]),window.alert(this.errors["yeti_prefix"]+e)},getYetiUrl(t){const e=J["a"].proj.transformExtent(t,"EPSG:3857","EPSG:4326"),a=this.bra.isDifferent?this.bra.low:this.bra.high,s=this.bra.isDifferent?this.bra.altiThreshold:0,i="mre"===this.method.type&&0!==this.method.orientation.length?"none,"+this.method.orientation.join(",").toLowerCase():"none",r="mrp"===this.method.type?this.method.potentialDanger:0,n="mrp"===this.method.type&&this.method.wetSnow,o="mrp"===this.method.type?Math.floor(this.method.groupSize):0;let l=Lt;return l+=`methode=${this.method.type};`,l+=`bbox=${e[0]},${e[1]},${e[2]},${e[3]};`,l+=`risque_haut=${this.bra.high};`,l+=`risque_bas=${a};`,l+=`seuil_alti=${s};`,l+=`rdv=${i};`,l+=`potentiel_danger=${r};`,l+=`neige_mouillee=${n};`,l+="taille_groupe="+o,l},onSubmitDisclaimer(){this.showDisclaimer=!1,this.$localStorage.set("yeti-disclaimer","validated")},onGpxLoaded(t){this.gpx=t}}},It=Pt,Ot=(a("806a"),a("2d99"),Object(m["a"])(It,s,i,!1,null,"b6fce666",null));e["default"]=Ot.exports},"9bbd":function(t,e,a){},"9e38":function(t,e,a){},a2cc:function(t,e,a){},a964:function(t,e,a){},aa66:function(t,e,a){t.exports=a.p+"img/logo-ensg.e6781953.jpg"},ac4e:function(t,e,a){},b636:function(t,e,a){"use strict";a("9bbd")},bd20:function(t,e,a){},d315:function(t,e,a){t.exports=a.p+"img/logo-fondation-petzl.24ab8a49.webp"},e004:function(t,e,a){t.exports=a.p+"img/logo-ensg.35fbf647.webp"},e237:function(t,e,a){},e375:function(t,e,a){"use strict";a("bd20")},e469:function(t,e,a){"use strict";a("9e38")},efa0:function(t,e,a){"use strict";a("03a8")},f6bf:function(t,e,a){"use strict";a("a964")},f894:function(t,e,a){},fc52:function(t,e,a){t.exports=a.p+"img/logo-fondation-petzl.4b665657.jpg"}}]);
//# sourceMappingURL=yeti-legacy.55170b8c.js.map